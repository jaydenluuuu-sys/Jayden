<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¶µæ¶µçš„ç”Ÿæ—¥é©šå–œ</title>
    <!-- å¼•å…¥ Tailwind CSS é€²è¡Œæ’ç‰ˆ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªå®šç¾©å‹•ç•«æ•ˆæœ */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        @keyframes pulse-slow {
            0%, 100% { opacity: 0.4; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        .animate-float { animation: float 6s ease-in-out infinite; }
        .animate-pulse-slow { animation: pulse-slow 4s ease-in-out infinite; }
        
        /* ç¿»ç‰Œæ•ˆæœ */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }

        .card-inner {
            transition: transform 0.6s;
        }
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        
        /* éœ‡å‹•å‹•ç•« (éŒ¯èª¤æ™‚) */
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* éš±è—æ»¾å‹•æ¢ä½†ä¿ç•™åŠŸèƒ½ */
        body { -ms-overflow-style: none; scrollbar-width: none; }
        body::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-pink-50 text-slate-800 font-sans min-h-screen overflow-hidden relative selection:bg-pink-200">

    <!-- èƒŒæ™¯è£é£¾ -->
    <div class="fixed inset-0 pointer-events-none z-0 overflow-hidden">
        <div class="absolute top-10 left-10 text-pink-200 animate-pulse-slow">
            <svg width="50" height="50" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
        </div>
        <div class="absolute bottom-20 right-10 text-pink-300 animate-float" style="animation-delay: 1s;">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
        </div>
        <div class="absolute top-1/2 left-1/4 text-red-100 animate-float" style="animation-delay: 2s;">
            <svg width="80" height="80" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
        </div>
    </div>

    <!-- ä¸»å…§å®¹å€ -->
    <div class="relative z-10 max-w-md mx-auto min-h-screen flex flex-col items-center justify-center p-6" id="app-container">
        
        <!-- Stage 0: æ­¡è¿é é¢ -->
        <div id="stage-0" class="text-center space-y-8 w-full transition-all duration-500">
            <div class="relative inline-block">
                <div class="absolute inset-0 bg-pink-200 rounded-full blur-xl opacity-50 animate-pulse"></div>
                <div class="relative bg-white p-6 rounded-full shadow-xl inline-flex">
                    <!-- Gift Icon -->
                    <svg class="w-16 h-16 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20 12a8 8 0 11-16 0 8 8 0 0116 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4"/></svg>
                    <svg class="w-16 h-16 text-pink-500 absolute" style="opacity: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/></svg>
                    <!-- Simple Gift SVG -->
                    <svg class="w-16 h-16 text-pink-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 12 20 22 4 22 4 12"></polyline><rect x="2" y="7" width="20" height="5"></rect><line x1="12" y1="22" x2="12" y2="7"></line><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path></svg>
                </div>
            </div>
            
            <div>
                <h1 class="text-3xl font-bold text-pink-600 mb-2">ç”Ÿæ—¥å¿«æ¨‚ï¼</h1>
                <p class="text-slate-500">é€™æ˜¯ä¸€å€‹å°ˆå±¬æ–¼å¦³çš„é—–é—œéŠæˆ²</p>
                <p class="text-slate-400 text-sm mt-1">é€šé—œå¾Œæœ‰ç¥ç§˜å°ç¦®ç‰©å–”â¤ï¸</p>
            </div>

            <button onclick="nextStage()" class="bg-gradient-to-r from-pink-500 to-rose-500 text-white px-8 py-3 rounded-full font-bold shadow-lg shadow-pink-300/50 hover:scale-105 transition-transform flex items-center gap-2 mx-auto">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                é–‹å§‹æŒ‘æˆ°
            </button>
        </div>

        <!-- Stage 1: å•ç­” -->
        <div id="stage-1" class="hidden w-full bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-xl border border-pink-100">
            <div class="mb-6">
                <span class="bg-pink-100 text-pink-600 text-xs font-bold px-2 py-1 rounded-md" id="quiz-counter">Q1</span>
                <h2 class="text-xl font-bold text-slate-700 mt-2" id="quiz-question">é¡Œç›®è¼‰å…¥ä¸­...</h2>
            </div>
            <div class="space-y-3" id="quiz-options">
                <!-- é¸é …æœƒç”± JS ç”Ÿæˆ -->
            </div>
            <p id="quiz-feedback" class="text-center text-red-400 text-sm mt-4 hidden">å†æƒ³ä¸€ä¸‹å–”ï½æ¶µæ¶µ ğŸ˜˜</p>
        </div>

        <!-- Stage 2: å¯†ç¢¼é– -->
        <div id="stage-2" class="hidden w-full flex flex-col items-center">
            <div class="mb-8 text-center">
                <div class="bg-pink-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-pink-500">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                </div>
                <h2 class="text-xl font-bold text-slate-700">è§£é–ä½ çš„å¿ƒ</h2>
                <p class="text-slate-400 text-sm mt-1">æç¤ºï¼šå¦³æœ€ç‰¹åˆ¥çš„æ—¥å­ (4ç¢¼)</p>
            </div>

            <div class="flex gap-4 mb-8" id="passcode-display">
                <div class="w-12 h-14 border-b-4 border-pink-300 text-pink-600 text-3xl flex items-center justify-center opacity-30 transition-all"></div>
                <div class="w-12 h-14 border-b-4 border-pink-300 text-pink-600 text-3xl flex items-center justify-center opacity-30 transition-all"></div>
                <div class="w-12 h-14 border-b-4 border-pink-300 text-pink-600 text-3xl flex items-center justify-center opacity-30 transition-all"></div>
                <div class="w-12 h-14 border-b-4 border-pink-300 text-pink-600 text-3xl flex items-center justify-center opacity-30 transition-all"></div>
            </div>

            <div class="grid grid-cols-3 gap-4 w-full max-w-[280px]">
                <!-- æ•¸å­—éµç›¤ -->
                <button onclick="addPasscode(1)" class="h-16 rounded-full bg-white shadow-sm border border-pink-50 text-xl font-semibold text-pink-500 active:scale-95 transition-transform">1</button>
                <button onclick="addPasscode(2)" class="h-16 rounded-full bg-white shadow-sm border border-pink-50 text-xl font-semibold text-pink-500 active:scale-95 transition-transform">2</button>
                <button onclick="addPasscode(3)" class="h-16 rounded-full bg-white shadow-sm border border-pink-50 text-xl font-semibold text-pink-500 active:scale-95 transition-transform">3</button>
                <button onclick="addPasscode(4)" class="h-16 rounded-full bg-white shadow-sm border border-pink-50 text-xl font-semibold text-pink-500 active:scale-95 transition-transform">4</button>
                <button onclick="addPasscode(5)" class="h-16 rounded-full bg-white shadow-sm border border-pink-50 text-xl font-semibold text-pink-500 active:scale-95 transition-transform">5</button>
                <button onclick="addPasscode(6)" class="h-16 rounded-full bg-white shadow-sm border border-pink-50 text-xl font-semibold text-pink-500 active:scale-95 transition-transform">6</button>
                <button onclick="addPasscode(7)" class="h-16 rounded-full bg-white shadow-sm border border-pink-50 text-xl font-semibold text-pink-500 active:scale-95 transition-transform">7</button>
                <button onclick="addPasscode(8)" class="h-16 rounded-full bg-white shadow-sm border border-pink-50 text-xl font-semibold text-pink-500 active:scale-95 transition-transform">8</button>
                <button onclick="addPasscode(9)" class="h-16 rounded-full bg-white shadow-sm border border-pink-50 text-xl font-semibold text-pink-500 active:scale-95 transition-transform">9</button>
                <div class="h-16"></div>
                <button onclick="addPasscode(0)" class="h-16 rounded-full bg-white shadow-sm border border-pink-50 text-xl font-semibold text-pink-500 active:scale-95 transition-transform">0</button>
                <button onclick="deletePasscode()" class="h-16 flex items-center justify-center text-slate-400 active:scale-95">âŒ«</button>
            </div>
            <p id="passcode-error" class="mt-4 text-red-500 font-medium hidden">å¯†ç¢¼éŒ¯èª¤ï¼Œæ˜¯ç”Ÿæ—¥å–”ï¼</p>
        </div>

        <!-- Stage 3: è¨˜æ†¶ç¿»ç‰Œ -->
        <div id="stage-3" class="hidden w-full text-center">
            <h2 class="text-xl font-bold text-slate-700 mb-2">æ„›çš„è¨˜æ†¶</h2>
            <p class="text-slate-400 text-sm mb-6">æ‰¾å‡ºæ‰€æœ‰ç›¸åŒçš„åœ–æ¡ˆ</p>
            <div class="grid grid-cols-4 gap-3 perspective-1000" id="memory-grid">
                <!-- å¡ç‰‡ç”± JS ç”Ÿæˆ -->
            </div>
        </div>

        <!-- Stage 4: æ…¶ç¥ -->
        <div id="stage-4" class="hidden w-full max-w-md text-center">
            <div class="bg-white/90 backdrop-blur-md p-8 rounded-2xl shadow-2xl border-4 border-pink-200 relative overflow-hidden">
                 <!-- è£é£¾ -->
                 <div class="absolute top-0 right-0 -mr-8 -mt-8 w-24 h-24 bg-red-400 rotate-45 opacity-20"></div>
                
                 <div class="mb-6 relative inline-block">
                     <div class="absolute inset-0 bg-yellow-200 rounded-full blur-xl opacity-60"></div>
                     <svg class="w-16 h-16 text-pink-500 relative z-10 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 15.546c-.523 0-1.046.151-1.5.454a2.704 2.704 0 01-3 0 2.704 2.704 0 00-3 0 2.704 2.704 0 01-3 0 2.704 2.704 0 00-3 0 2.704 2.704 0 01-3 0 2.701 2.701 0 00-1.5-.454M9 6v2m3-2v2m3-2v2M9 3h.01M12 3h.01M15 3h.01M21 21v-7a2 2 0 00-2-2H5a2 2 0 00-2 2v7h18zm-3-9v-2a2 2 0 00-2-2H8a2 2 0 00-2 2v2h12z"/></svg>
                 </div>
 
                 <h1 class="text-2xl font-bold text-slate-800 mb-2" id="letter-title">çµ¦æœ€æ„›çš„æ¶µæ¶µ</h1>
                 <div class="h-1 w-20 bg-pink-300 mx-auto rounded-full mb-6"></div>
 
                 <div class="text-left text-slate-600 leading-relaxed font-medium bg-pink-50 p-6 rounded-xl border border-pink-100 mb-8" id="letter-content">
                     <!-- ä¿¡ä»¶å…§å®¹ -->
                 </div>
 
                 <div class="flex justify-center gap-2 text-2xl">
                    <span class="animate-pulse">â¤ï¸</span>
                    <span class="animate-pulse" style="animation-delay: 0.2s">ğŸ‚</span>
                    <span class="animate-pulse" style="animation-delay: 0.4s">ğŸ</span>
                 </div>
            </div>
        </div>

        <!-- é å°¾é€²åº¦æ¢ -->
        <div id="progress-bar-container" class="absolute bottom-6 w-full max-w-md px-10 hidden">
            <div class="h-2 bg-pink-100 rounded-full overflow-hidden">
                <div id="progress-fill" class="h-full bg-pink-500 transition-all duration-500 ease-out" style="width: 0%"></div>
            </div>
            <p id="progress-text" class="text-center text-pink-300 text-xs mt-2">Level 1 / 3</p>
        </div>

        <!-- ç¦®èŠ±å®¹å™¨ -->
        <div id="confetti-container" class="fixed inset-0 pointer-events-none z-50 hidden"></div>
    </div>

    <script>
        // --- éŠæˆ²è³‡æ–™è¨­å®š (è«‹åœ¨æ­¤ä¿®æ”¹) ---
        
        const QUIZ_DATA = [
            {
                question: "æˆ‘å€‘ç¬¬ä¸€æ¬¡è¦‹é¢é‚£å¤©åšäº†ç”šéº¼ï¼Ÿ",
                options: ["å–å’–å•¡", "åƒç«é‹", "ç¥ç¥è·‘å»æ‹‰è‚šå­", "ä»¥ä¸Šçš†æ˜¯"],
                answer: "ä»¥ä¸Šçš†æ˜¯"
            },
            {
                question: "æˆ‘å€‘åœ¨ä¸€èµ·çš„é€™æ®µæ™‚é–“ç¸½å…±çœ‹äº†å¹¾å ´é›»å½±?",
                options: ["1", "2", "3", "4"],
                answer: "2"
            },
            {
                question: "ç¥ç¥æ›¾è²·äº†ä»Šå¹´æœ€è²´æ‰‹ç‡ˆ(å«é›»æ± )ï¼Œè™Ÿç¨±æ‰‹ç‡ˆå°ç©é›»ï¼Œè«‹å•åƒ¹æ ¼å¤šå°‘éŒ¢?",
                options: ["1920", "1930", "1940", "1950"],
                answer: "1940"
            },
            {
                question: "æˆ‘å€‘ç¬¬äºŒæ¬¡è¦‹é¢æ˜¯å»å“ªè£¡åƒæ™šé¤?",
                options: ["æ¡ƒåœ’", "æ–°åŒ—", "å°åŒ—", "ä»¥ä¸Šçš†é"],
                answer: "å°åŒ—"
            },
            
            {
                question: "é‡‘å¸Œæ¾ˆæœ€è¿‘æœ€å¸¸ç©çš„éŠæˆ²",
                options: ["LOLè‹±é›„è¯ç›Ÿ", "å¹»å¡”2", "é¬¥é™£ç‰¹æ”»", "æ°¸æ†ä¹‹å¡”2"],
                answer: "æ°¸æ†ä¹‹å¡”2"
            },


        ];

        const SECRET_CODE = "1125"; 

        const FINAL_LETTER_TITLE = "Dearæ¶µæ¶µ";
        const FINAL_LETTER_CONTENT = `
            æ¶µæ¶µï¼Œç”Ÿæ—¥å¿«æ¨‚ï¼<br/><br/>
            é€™æ˜¯æˆ‘åœ¨ç”Ÿæ—¥é€™å¤©æº–å‚™çš„å°å°é©šå–œã€‚<br/>
            å¾ˆè¬è¬ç•¶åˆä¸‹è¼‰SOGAçš„è‡ªå·±ï¼Œ<br/>
            é‡åˆ°äº†ä¸€ä½å¤šæ‰å¤šè—ä¸”å¾ˆçœŸèª çš„å¥³å‹ã€‚<br/><br/>
            å¸Œæœ›æœªä¾†çš„æ¯ä¸€å€‹é‡è¦ç¯€æ—¥ï¼Œ<br/>
            æˆ‘éƒ½èƒ½å¸¶çµ¦å¦³è¨±å¤šé©šå–œã€‚<br/><br/>
            ä¹ŸçŸ¥é“ä½ æœ‰æ™‚å€™æœƒå¾ˆå¿™ï¼Œ<br/>
            å¸Œæœ›ä½ å¯ä»¥å¤šå¤šä¼‘æ¯ï¼Œæˆ‘å€‘å†ä¸€èµ·å‡ºå»ç©å–”ã€‚<br/><br/>
            æ„›å¦³çš„ç¥ç¥
        `;

        // --- éŠæˆ²é‚è¼¯ (ä¸€èˆ¬ä¸éœ€è¦ä¿®æ”¹) ---

        let currentStage = 0;
        let currentQuizIndex = 0;
        let passcode = "";
        let memoryCards = [];
        let flippedCards = [];
        let lockBoard = false;

        // åˆå§‹åŒ–
        window.onload = () => {
            document.getElementById('letter-title').innerText = FINAL_LETTER_TITLE;
            document.getElementById('letter-content').innerHTML = FINAL_LETTER_CONTENT;
        };

        function nextStage() {
            // éš±è—ç•¶å‰ Stage
            document.getElementById(`stage-${currentStage}`).classList.add('hidden');
            
            currentStage++;
            
            // é¡¯ç¤ºä¸‹ä¸€å€‹ Stage
            const nextEl = document.getElementById(`stage-${currentStage}`);
            if (nextEl) {
                nextEl.classList.remove('hidden');
                // å‹•ç•«æ•ˆæœ
                nextEl.classList.add('animate-float'); // ç°¡å–®é‡ç½®å‹•ç•«
                setTimeout(() => nextEl.classList.remove('animate-float'), 500);
            }

            // è™•ç†é€²åº¦æ¢
            const progressContainer = document.getElementById('progress-bar-container');
            if (currentStage > 0 && currentStage < 4) {
                progressContainer.classList.remove('hidden');
                document.getElementById('progress-fill').style.width = `${(currentStage / 3) * 100}%`;
                document.getElementById('progress-text').innerText = `Level ${currentStage} / 3`;
            } else {
                progressContainer.classList.add('hidden');
            }

            // Stage åˆå§‹åŒ–é‚è¼¯
            if (currentStage === 1) initQuiz();
            if (currentStage === 3) initMemoryGame();
            if (currentStage === 4) startConfetti();
        }

        // --- Stage 1: Quiz ---
        function initQuiz() {
            currentQuizIndex = 0;
            renderQuiz();
        }

        function renderQuiz() {
            const data = QUIZ_DATA[currentQuizIndex];
            document.getElementById('quiz-counter').innerText = `Q${currentQuizIndex + 1}`;
            document.getElementById('quiz-question').innerText = data.question;
            
            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = '';

            data.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "w-full p-4 rounded-xl text-left transition-all border-2 border-slate-100 hover:border-pink-300 text-slate-600 bg-white flex justify-between items-center";
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(btn, opt, data.answer);
                optionsContainer.appendChild(btn);
            });

            document.getElementById('quiz-feedback').classList.add('hidden');
        }

        function checkAnswer(btn, selected, correct) {
            const allBtns = document.getElementById('quiz-options').children;
            for(let b of allBtns) b.disabled = true;

            if (selected === correct) {
                btn.classList.remove('border-slate-100');
                btn.classList.add('bg-green-50', 'border-green-500', 'text-green-700');
                btn.innerHTML += ' <span>âœ“</span>';
                
                setTimeout(() => {
                    if (currentQuizIndex < QUIZ_DATA.length - 1) {
                        currentQuizIndex++;
                        renderQuiz();
                    } else {
                        nextStage();
                    }
                }, 800);
            } else {
                btn.classList.remove('border-slate-100');
                btn.classList.add('bg-red-50', 'border-red-500', 'text-red-700', 'shake');
                btn.innerHTML += ' <span>âœ•</span>';
                document.getElementById('quiz-feedback').classList.remove('hidden');
                
                setTimeout(() => {
                    btn.classList.remove('shake');
                    for(let b of allBtns) b.disabled = false;
                    // é‡ç½®æ¨£å¼
                    btn.classList.remove('bg-red-50', 'border-red-500', 'text-red-700');
                    btn.classList.add('border-slate-100');
                    btn.innerText = selected; 
                }, 1000);
            }
        }

        // --- Stage 2: Passcode ---
        function updatePasscodeDisplay() {
            const dots = document.getElementById('passcode-display').children;
            for (let i = 0; i < 4; i++) {
                if (i < passcode.length) {
                    dots[i].innerText = 'â¤';
                    dots[i].classList.remove('opacity-30');
                } else {
                    dots[i].innerText = '';
                    dots[i].classList.add('opacity-30');
                }
            }
        }

        function addPasscode(num) {
            if (passcode.length < 4) {
                passcode += num;
                updatePasscodeDisplay();
                document.getElementById('passcode-error').classList.add('hidden');
                
                if (passcode.length === 4) {
                    if (passcode === SECRET_CODE) {
                        setTimeout(nextStage, 300);
                    } else {
                        document.getElementById('passcode-error').classList.remove('hidden');
                        setTimeout(() => {
                            passcode = "";
                            updatePasscodeDisplay();
                        }, 800);
                    }
                }
            }
        }

        function deletePasscode() {
            passcode = passcode.slice(0, -1);
            updatePasscodeDisplay();
        }

        // --- Stage 3: Memory Game ---
        function initMemoryGame() {
            // SVG icons paths
            const icons = [
                '<path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>', // Heart
                '<path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>', // Star
                '<path d="M20 12a8 8 0 11-16 0 8 8 0 0116 0z"/><path d="M9 12l2 2 4-4"/>', // Check(Smile-ish) or Gift
                '<path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>' // Box
            ];
            
            let deck = [...icons, ...icons];
            deck.sort(() => Math.random() - 0.5);

            const grid = document.getElementById('memory-grid');
            grid.innerHTML = '';
            
            deck.forEach((iconPath, index) => {
                const card = document.createElement('div');
                card.className = 'card relative aspect-square cursor-pointer perspective-1000';
                card.innerHTML = `
                    <div class="card-inner w-full h-full relative transform-style-3d duration-500">
                        <div class="absolute w-full h-full bg-white shadow-md border-2 border-pink-50 rounded-xl flex items-center justify-center backface-hidden">
                            <span class="text-pink-200 text-xl">?</span>
                        </div>
                        <div class="absolute w-full h-full bg-gradient-to-br from-pink-400 to-rose-400 rounded-xl flex items-center justify-center rotate-y-180 backface-hidden">
                            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">${iconPath}</svg>
                        </div>
                    </div>
                `;
                
                card.onclick = () => flipCard(card, iconPath);
                grid.appendChild(card);
            });
        }

        function flipCard(card, icon) {
            if (lockBoard || card.classList.contains('flipped')) return;

            card.classList.add('flipped');
            flippedCards.push({ card, icon });

            if (flippedCards.length === 2) {
                lockBoard = true;
                checkMatch();
            }
        }

        function checkMatch() {
            const [first, second] = flippedCards;
            const isMatch = first.icon === second.icon;

            if (isMatch) {
                flippedCards = [];
                lockBoard = false;
                // Check win
                const allFlipped = document.querySelectorAll('.card.flipped').length;
                if (allFlipped === 8) {
                    setTimeout(nextStage, 1000);
                }
            } else {
                setTimeout(() => {
                    first.card.classList.remove('flipped');
                    second.card.classList.remove('flipped');
                    flippedCards = [];
                    lockBoard = false;
                }, 1000);
            }
        }

        // --- Confetti Effect ---
        function startConfetti() {
            const container = document.getElementById('confetti-container');
            container.classList.remove('hidden');
            const colors = ['#FFC0CB', '#FF69B4', '#FFD700', '#87CEEB'];
            
            for (let i = 0; i < 50; i++) {
                const el = document.createElement('div');
                el.className = 'absolute w-2 h-2 rounded-full';
                el.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                el.style.left = Math.random() * 100 + '%';
                el.style.top = -10 + 'px';
                el.style.animation = `fall ${Math.random() * 3 + 2}s linear infinite`;
                el.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(el);
            }
        }

        // Add CSS for confetti
        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            @keyframes fall {
                to { transform: translateY(100vh) rotate(360deg); }
            }
        `;
        document.head.appendChild(styleSheet);

    </script>
</body>
</html>